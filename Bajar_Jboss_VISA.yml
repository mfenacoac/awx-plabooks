---
- name: Detener JBoss y limpiar logs
  hosts: all
  gather_facts: no
  tasks:
    - name: Detener JBoss usando jboss-cli
      win_shell: >
        C:\Temenos\R18\3rdParty\As\jboss-eap-7.2\bin\jboss-cli.bat --connect command=:shutdown
      register: shutdown_result
    
    - name: Esperar 120 segundos para asegurar que JBoss se detuvo
      pause:
        seconds: 120
    
    - name: Borrar CONTENIDO de carpetas tmp y data de JBoss (no las carpetas)
      win_shell: |
        Remove-Item -Path 'C:\Temenos\R18\3rdParty\As\jboss-eap-7.2\standalone\tmp\*' -Recurse -Force -ErrorAction SilentlyContinue
        Remove-Item -Path 'C:\Temenos\R18\3rdParty\As\jboss-eap-7.2\standalone\data\*' -Recurse -Force -ErrorAction SilentlyContinue
        Remove-Item -Path 'C:\Temenos\R18\3rdParty\As\jboss-eap-7.2\standalone\log\*' -Recurse -Force -ErrorAction SilentlyContinue
    
    - name: Eliminar archivos de estado de despliegue en JBoss
      win_shell: |
        Remove-Item -Path 'C:\Temenos\R18\3rdParty\As\jboss-eap-7.2\standalone\deployments\*.deployed' -Force -ErrorAction SilentlyContinue
        Remove-Item -Path 'C:\Temenos\R18\3rdParty\As\jboss-eap-7.2\standalone\deployments\*.undeployed' -Force -ErrorAction SilentlyContinue
        Remove-Item -Path 'C:\Temenos\R18\3rdParty\As\jboss-eap-7.2\standalone\deployments\*.failed' -Force -ErrorAction SilentlyContinue
        Remove-Item -Path 'C:\Temenos\R18\3rdParty\As\jboss-eap-7.2\standalone\deployments\*.isdeploying' -Force -ErrorAction SilentlyContinue
